import*as e from"https://cdn.jsdelivr.net/npm/three@0.117.1/build/three.module.js";import{OrbitControls as t}from"https://cdn.jsdelivr.net/npm/three@0.124/examples/jsm/controls/OrbitControls.js";let n=document.getElementById("sphererenderer"),r=new e.Scene,o=new e.PerspectiveCamera(75,1,.1,1e3),l=new e.WebGLRenderer({canvas:n,antialias:!0});l.setSize(250,250),l.setPixelRatio(2),l.setClearColor(16777195);let a=new t(o,l.domElement),s=new e.SphereGeometry(8,16,16),i=new e.WireframeGeometry(s),h=new e.LineBasicMaterial({color:0,transparent:!0,opacity:.5}),p=new e.LineSegments(i,h);r.add(p);let u=new e.BufferGeometry,c=new e.PointsMaterial({size:1,vertexColors:!0}),d=new e.Points(u,c);r.add(d);let w=[],f=[];async function m(t){let n=new Float32Array(t);f=[];for(let e=0;e<t.length;e+=3){let{r:n,theta:r,phi:o}=function(e,t,n){let r=Math.sqrt(e*e+t*t+n*n);if(r<.05)return{r,theta:0,phi:0};let o=Math.acos(n/r);return{r,theta:o,phi:Math.atan2(t,e)}}(t[e],t[e+1],t[e+2]);f.push(n,r,o)}w.length!=f.length&&(console.log("qubit length changed"),w=f);let r=[],o=[];for(let e=0;e<n.length;e+=3){let t=!1;for(let l=0;l<o.length;l+=1){let a=n[e]-r[3*l],s=n[e+1]-r[3*l+1],i=n[e+2]-r[3*l+2];.05>Math.sqrt(a*a+s*s+i*i)&&(o[l]+=1,t=!0)}t||(r.push(n[e],n[e+1],n[e+2]),o.push(0))}let l=[];for(let t=0;t<o.length;t++){let r=n.length/3-1;0==r&&(r=1e3);let a=new e.Color().setHSL((1-o[t]/r)*.7,.8,.5);l.push(a.r,a.g,a.b)}let a=[];for(let e=0;e<n.length;e+=3)for(let t=0;t<r.length;t+=3){let o=n[e]-r[t],s=n[e+1]-r[t+1],i=n[e+2]-r[t+2];.05>Math.sqrt(o*o+s*s+i*i)&&a.push(l[t],l[t+1],l[t+2])}u.setAttribute("color",new e.Float32BufferAttribute(a,3)),u.attributes.color.needsUpdate=!0}function g(t,n){let o=new e.LineCurve3(new e.Vector3(0,0,0),t),l=new e.TubeGeometry(o,4,.2,8,!1),a=new e.MeshBasicMaterial({color:n,transparent:!0,opacity:.5}),s=new e.Mesh(l,a);r.add(s)}document.addEventListener("blochpointsupdate",function(e){m(e.detail)}),m([0,8,0]),g(new e.Vector3(8,0,0),16711680),g(new e.Vector3(0,8,0),65280),g(new e.Vector3(0,0,8),255),o.position.x=7.1,o.position.y=10.6,o.position.z=7.1,a.update(),function t(){var n,s,i,h;requestAnimationFrame(t),a.update();for(let e=0;e<w.length;e+=1){;w[e]=(n=w[e])+(f[e]-n)*.1}let p=[];for(let e=0;e<w.length;e+=3){;let{x:t,y:n,z:r}=(s=w[e],i=w[e+1],{x:s*Math.sin(i)*Math.cos(h=w[e+2]),y:s*Math.sin(i)*Math.sin(h),z:s*Math.cos(i)});p.push(t,n,r)}u.setAttribute("position",new e.BufferAttribute(new Float32Array(p),3)),u.attributes.position.needsUpdate=!0,l.render(r,o)}();